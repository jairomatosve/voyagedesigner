# ğŸŒ TravelOrchestrator - ImplementaciÃ³n MultilingÃ¼e (i18n)

## ğŸ“Œ Estrategia MultilingÃ¼e

**Idiomas Fase 1:**
- ğŸ‡ªğŸ‡¸ EspaÃ±ol (es)
- ğŸ‡ºğŸ‡¸ English (en)
- ğŸ‡µğŸ‡¹ PortuguÃªs (pt)
- ğŸ‡«ğŸ‡· FranÃ§ais (fr)

**Idiomas Fase 2:**
- ğŸ‡®ğŸ‡¹ Italiano (it)
- ğŸ‡©ğŸ‡ª Deutsch (de)
- ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª (ja)
- ğŸ‡¨ğŸ‡³ ä¸­æ–‡ (zh)

---

## ğŸ—ï¸ Stack i18n

| Componente | LibrerÃ­a | RazÃ³n |
|-----------|----------|-------|
| Frontend | `i18next` + `react-i18next` | EstÃ¡ndar industria, fÃ¡cil de integrar |
| Backend | `i18next` (Node.js) | Mismo formato que frontend |
| Storage | JSON files | Versionable, fÃ¡cil de mantener |
| Language Detection | Browser language + User preference | Auto-detect + manual override |
| Fallback | English | Si idioma no disponible, muestra EN |

---

## ğŸ“ Estructura de Archivos (Frontend)

```
frontend/
â”œâ”€ src/
â”‚  â”œâ”€ locales/
â”‚  â”‚  â”œâ”€ en/
â”‚  â”‚  â”‚  â”œâ”€ auth.json
â”‚  â”‚  â”‚  â”œâ”€ trips.json
â”‚  â”‚  â”‚  â”œâ”€ itinerary.json
â”‚  â”‚  â”‚  â”œâ”€ budget.json
â”‚  â”‚  â”‚  â”œâ”€ common.json
â”‚  â”‚  â”‚  â””â”€ errors.json
â”‚  â”‚  â”œâ”€ es/
â”‚  â”‚  â”‚  â”œâ”€ auth.json
â”‚  â”‚  â”‚  â”œâ”€ trips.json
â”‚  â”‚  â”‚  â”œâ”€ itinerary.json
â”‚  â”‚  â”‚  â”œâ”€ budget.json
â”‚  â”‚  â”‚  â”œâ”€ common.json
â”‚  â”‚  â”‚  â””â”€ errors.json
â”‚  â”‚  â”œâ”€ pt/
â”‚  â”‚  â”‚  â””â”€ (igual estructura)
â”‚  â”‚  â””â”€ fr/
â”‚  â”‚     â””â”€ (igual estructura)
â”‚  â”œâ”€ i18n/
â”‚  â”‚  â””â”€ config.js (configuraciÃ³n i18next)
â”‚  â”œâ”€ components/
â”‚  â”‚  â””â”€ LanguageSwitcher.jsx
â”‚  â””â”€ App.jsx (con i18next provider)
```

---

## ğŸ’¾ Archivos de Traducciones (JSON)

### frontend/src/locales/en/auth.json
```json
{
  "login": {
    "title": "Sign In",
    "email_placeholder": "Email",
    "password_placeholder": "Password",
    "button": "Sign In",
    "signing_in": "Signing in...",
    "no_account": "Don't have an account?",
    "sign_up_link": "Sign up"
  },
  "signup": {
    "title": "Join TravelOrchestrator",
    "name_placeholder": "Full Name",
    "email_placeholder": "Email",
    "password_placeholder": "Password",
    "button": "Sign Up",
    "creating": "Creating account...",
    "have_account": "Already have an account?",
    "sign_in_link": "Sign in"
  },
  "errors": {
    "login_failed": "Login failed",
    "registration_failed": "Registration failed",
    "invalid_email": "Invalid email",
    "password_too_short": "Password must be at least 8 characters",
    "email_already_exists": "Email already exists"
  }
}
```

### frontend/src/locales/es/auth.json
```json
{
  "login": {
    "title": "Iniciar SesiÃ³n",
    "email_placeholder": "Correo",
    "password_placeholder": "ContraseÃ±a",
    "button": "Iniciar SesiÃ³n",
    "signing_in": "Iniciando sesiÃ³n...",
    "no_account": "Â¿No tienes cuenta?",
    "sign_up_link": "RegÃ­strate"
  },
  "signup": {
    "title": "Ãšnete a TravelOrchestrator",
    "name_placeholder": "Nombre Completo",
    "email_placeholder": "Correo",
    "password_placeholder": "ContraseÃ±a",
    "button": "Registrarse",
    "creating": "Creando cuenta...",
    "have_account": "Â¿Ya tienes cuenta?",
    "sign_in_link": "Inicia sesiÃ³n"
  },
  "errors": {
    "login_failed": "Error al iniciar sesiÃ³n",
    "registration_failed": "Error al registrarse",
    "invalid_email": "Correo invÃ¡lido",
    "password_too_short": "La contraseÃ±a debe tener al menos 8 caracteres",
    "email_already_exists": "El correo ya existe"
  }
}
```

### frontend/src/locales/en/trips.json
```json
{
  "dashboard": {
    "title": "Your Dashboard",
    "logout": "Logout",
    "create_trip": "Create Trip",
    "no_trips": "No trips yet. Create one to get started!",
    "destination": "Destination",
    "budget": "Budget",
    "dates": "Dates"
  },
  "create_trip": {
    "title": "Create a New Trip",
    "title_placeholder": "Trip Title",
    "destination_placeholder": "Destination",
    "start_date": "Start Date",
    "end_date": "End Date",
    "budget_placeholder": "Total Budget ($)",
    "description_placeholder": "Description (optional)",
    "button": "Create Trip",
    "creating": "Creating..."
  },
  "trip_detail": {
    "title": "Trip Details",
    "days_remaining": "Days remaining"
  }
}
```

### frontend/src/locales/es/trips.json
```json
{
  "dashboard": {
    "title": "Tu Panel de Control",
    "logout": "Cerrar SesiÃ³n",
    "create_trip": "Crear Viaje",
    "no_trips": "No hay viajes aÃºn. Â¡Crea uno para empezar!",
    "destination": "Destino",
    "budget": "Presupuesto",
    "dates": "Fechas"
  },
  "create_trip": {
    "title": "Crear un Nuevo Viaje",
    "title_placeholder": "Nombre del Viaje",
    "destination_placeholder": "Destino",
    "start_date": "Fecha de Inicio",
    "end_date": "Fecha de Fin",
    "budget_placeholder": "Presupuesto Total ($)",
    "description_placeholder": "DescripciÃ³n (opcional)",
    "button": "Crear Viaje",
    "creating": "Creando..."
  },
  "trip_detail": {
    "title": "Detalles del Viaje",
    "days_remaining": "DÃ­as restantes"
  }
}
```

### frontend/src/locales/en/itinerary.json
```json
{
  "generator": {
    "title": "AI Itinerary Generator",
    "interests_label": "Interests",
    "pace_label": "Travel Pace",
    "pace_relaxed": "Relaxed",
    "pace_moderate": "Moderate",
    "pace_fast": "Fast-paced",
    "button": "Generate Itinerary with AI",
    "generating": "Generating your itinerary..."
  },
  "viewer": {
    "title": "Your Itinerary",
    "no_itinerary": "Generate an itinerary to see it here"
  },
  "activity": {
    "status_planned": "Planned",
    "status_ongoing": "Ongoing",
    "status_completed": "Completed",
    "status_skipped": "Skipped",
    "estimated_cost": "Cost"
  },
  "reoptimizer": {
    "title": "Reoptimization Assistant",
    "button": "Get Suggestions",
    "no_suggestions": "Mark an activity as 'Skipped' to get suggestions",
    "accept": "Accept",
    "decline": "Decline"
  }
}
```

### frontend/src/locales/es/itinerary.json
```json
{
  "generator": {
    "title": "Generador de Itinerario con IA",
    "interests_label": "Intereses",
    "pace_label": "Ritmo de Viaje",
    "pace_relaxed": "Relajado",
    "pace_moderate": "Moderado",
    "pace_fast": "RÃ¡pido",
    "button": "Generar Itinerario con IA",
    "generating": "Generando tu itinerario..."
  },
  "viewer": {
    "title": "Tu Itinerario",
    "no_itinerary": "Genera un itinerario para verlo aquÃ­"
  },
  "activity": {
    "status_planned": "Planeado",
    "status_ongoing": "En Progreso",
    "status_completed": "Completado",
    "status_skipped": "Omitido",
    "estimated_cost": "Costo"
  },
  "reoptimizer": {
    "title": "Asistente de ReoptimizaciÃ³n",
    "button": "Obtener Sugerencias",
    "no_suggestions": "Marca una actividad como 'Omitida' para obtener sugerencias",
    "accept": "Aceptar",
    "decline": "Rechazar"
  }
}
```

### frontend/src/locales/en/common.json
```json
{
  "app_name": "TravelOrchestrator",
  "app_tagline": "Plan Smart, Travel Better",
  "loading": "Loading...",
  "error": "Error",
  "success": "Success",
  "cancel": "Cancel",
  "save": "Save",
  "delete": "Delete",
  "edit": "Edit",
  "close": "Close",
  "yes": "Yes",
  "no": "No",
  "language": "Language"
}
```

### frontend/src/locales/es/common.json
```json
{
  "app_name": "TravelOrchestrator",
  "app_tagline": "Planifica Inteligente, Viaja Mejor",
  "loading": "Cargando...",
  "error": "Error",
  "success": "Ã‰xito",
  "cancel": "Cancelar",
  "save": "Guardar",
  "delete": "Eliminar",
  "edit": "Editar",
  "close": "Cerrar",
  "yes": "SÃ­",
  "no": "No",
  "language": "Idioma"
}
```

---

## âš™ï¸ ConfiguraciÃ³n Frontend

### frontend/src/i18n/config.js
```javascript
import i18n from 'i18next';
import { initReactI18next } from 'react-i18next';
import LanguageDetector from 'i18next-browser-languagedetector';

// Importar traducciones
import en_auth from '../locales/en/auth.json';
import en_trips from '../locales/en/trips.json';
import en_itinerary from '../locales/en/itinerary.json';
import en_common from '../locales/en/common.json';

import es_auth from '../locales/es/auth.json';
import es_trips from '../locales/es/trips.json';
import es_itinerary from '../locales/es/itinerary.json';
import es_common from '../locales/es/common.json';

import pt_auth from '../locales/pt/auth.json';
import pt_trips from '../locales/pt/trips.json';
import pt_itinerary from '../locales/pt/itinerary.json';
import pt_common from '../locales/pt/common.json';

import fr_auth from '../locales/fr/auth.json';
import fr_trips from '../locales/fr/trips.json';
import fr_itinerary from '../locales/fr/itinerary.json';
import fr_common from '../locales/fr/common.json';

const resources = {
  en: {
    auth: en_auth,
    trips: en_trips,
    itinerary: en_itinerary,
    common: en_common
  },
  es: {
    auth: es_auth,
    trips: es_trips,
    itinerary: es_itinerary,
    common: es_common
  },
  pt: {
    auth: pt_auth,
    trips: pt_trips,
    itinerary: pt_itinerary,
    common: pt_common
  },
  fr: {
    auth: fr_auth,
    trips: fr_trips,
    itinerary: fr_itinerary,
    common: fr_common
  }
};

i18n
  .use(LanguageDetector) // Auto-detecta idioma del browser
  .use(initReactI18next)
  .init({
    resources,
    fallbackLng: 'en',
    ns: ['auth', 'trips', 'itinerary', 'common'],
    defaultNS: 'common',
    interpolation: {
      escapeValue: false // React protege contra XSS
    }
  });

export default i18n;
```

### frontend/src/main.jsx (ACTUALIZAR)
```jsx
import React from 'react'
import ReactDOM from 'react-dom/client'
import App from './App.jsx'
import './index.css'
import './i18n/config.js' // â† AGREGAR ESTA LÃNEA

ReactDOM.createRoot(document.getElementById('root')).render(
  <React.StrictMode>
    <App />
  </React.StrictMode>,
)
```

---

## ğŸŒ Componentes i18n

### frontend/src/components/LanguageSwitcher.jsx
```jsx
import { useTranslation } from 'react-i18next';

export default function LanguageSwitcher() {
  const { i18n } = useTranslation();

  const languages = [
    { code: 'en', name: 'ğŸ‡ºğŸ‡¸ English' },
    { code: 'es', name: 'ğŸ‡ªğŸ‡¸ EspaÃ±ol' },
    { code: 'pt', name: 'ğŸ‡µğŸ‡¹ PortuguÃªs' },
    { code: 'fr', name: 'ğŸ‡«ğŸ‡· FranÃ§ais' }
  ];

  return (
    <div className="flex gap-2">
      {languages.map((lang) => (
        <button
          key={lang.code}
          onClick={() => {
            i18n.changeLanguage(lang.code);
            localStorage.setItem('language', lang.code);
          }}
          className={`px-3 py-1 rounded text-sm font-semibold transition ${
            i18n.language === lang.code
              ? 'bg-blue-500 text-white'
              : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
          }`}
        >
          {lang.name}
        </button>
      ))}
    </div>
  );
}
```

### frontend/src/components/Auth/LoginPage.jsx (ACTUALIZADO)
```jsx
import { useState } from 'react';
import { useNavigate } from 'react-router-dom';
import { useTranslation } from 'react-i18next';
import { authAPI } from '../../services/api';
import { useAppStore } from '../../store/appStore';
import LanguageSwitcher from '../LanguageSwitcher';

export default function LoginPage() {
  const navigate = useNavigate();
  const { t } = useTranslation(['auth', 'common']);
  const setAuth = useAppStore((state) => state.setAuth);
  const [formData, setFormData] = useState({ email: '', password: '' });
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState('');

  const handleSubmit = async (e) => {
    e.preventDefault();
    setLoading(true);
    setError('');

    try {
      const response = await authAPI.login(formData.email, formData.password);
      setAuth(response.data.user, response.data.token);
      navigate('/dashboard');
    } catch (err) {
      setError(err.response?.data?.error || t('auth:errors.login_failed'));
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="flex items-center justify-center min-h-screen bg-gradient-to-br from-blue-500 to-purple-600">
      <div className="bg-white rounded-lg shadow-xl p-8 w-full max-w-md">
        <div className="flex justify-between items-center mb-6">
          <h1 className="text-3xl font-bold">ğŸŒ {t('common:app_name')}</h1>
          <LanguageSwitcher />
        </div>

        <form onSubmit={handleSubmit} className="space-y-4">
          {error && <div className="bg-red-100 text-red-700 p-3 rounded">{error}</div>}
          
          <input
            type="email"
            placeholder={t('auth:login.email_placeholder')}
            value={formData.email}
            onChange={(e) => setFormData({ ...formData, email: e.target.value })}
            className="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
            required
          />
          
          <input
            type="password"
            placeholder={t('auth:login.password_placeholder')}
            value={formData.password}
            onChange={(e) => setFormData({ ...formData, password: e.target.value })}
            className="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
            required
          />
          
          <button
            type="submit"
            disabled={loading}
            className="w-full bg-blue-500 text-white py-2 rounded-lg font-semibold hover:bg-blue-600 disabled:opacity-50"
          >
            {loading ? t('common:loading') : t('auth:login.button')}
          </button>
        </form>

        <p className="text-center mt-4 text-gray-600">
          {t('auth:login.no_account')}{' '}
          <a href="/signup" className="text-blue-500 font-semibold">{t('auth:login.sign_up_link')}</a>
        </p>
      </div>
    </div>
  );
}
```

---

## ğŸ”¤ Backend i18n (Validaciones)

### backend/src/i18n/config.js
```javascript
const i18n = require('i18next');
const Backend = require('i18next-fs-backend');

i18n.use(Backend).init({
  lng: 'en',
  fallbackLng: 'en',
  ns: ['common', 'errors'],
  defaultNS: 'common',
  backend: {
    loadPath: __dirname + '/../locales/{{lng}}/{{ns}}.json'
  }
});

module.exports = i18n;
```

### backend/src/locales/en/errors.json
```json
{
  "invalid_email": "Invalid email address",
  "password_too_short": "Password must be at least 8 characters",
  "email_already_exists": "Email already exists",
  "invalid_credentials": "Invalid email or password",
  "trip_not_found": "Trip not found",
  "unauthorized": "Unauthorized",
  "internal_error": "Internal server error"
}
```

### backend/src/locales/es/errors.json
```json
{
  "invalid_email": "DirecciÃ³n de correo invÃ¡lida",
  "password_too_short": "La contraseÃ±a debe tener al menos 8 caracteres",
  "email_already_exists": "El correo ya existe",
  "invalid_credentials": "Correo o contraseÃ±a invÃ¡lidos",
  "trip_not_found": "Viaje no encontrado",
  "unauthorized": "No autorizado",
  "internal_error": "Error interno del servidor"
}
```

---

## ğŸ—„ï¸ Almacenar Idioma Preferido del Usuario

### Backend - Tabla: user_preferences

```sql
ALTER TABLE users ADD COLUMN preferred_language VARCHAR(10) DEFAULT 'en';
ALTER TABLE users ADD COLUMN preferred_timezone VARCHAR(50) DEFAULT 'UTC';

CREATE TABLE user_preferences (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  preferred_language VARCHAR(10) DEFAULT 'en',
  preferred_timezone VARCHAR(50) DEFAULT 'UTC',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  UNIQUE(user_id)
);
```

### Backend - API: Guardar preferencia

```javascript
// POST /api/user/preferences
router.post('/preferences', authMiddleware, async (req, res) => {
  try {
    const { preferredLanguage, preferredTimezone } = req.body;

    const { data, error } = await supabase
      .from('user_preferences')
      .upsert({
        user_id: req.user.id,
        preferred_language: preferredLanguage,
        preferred_timezone: preferredTimezone
      })
      .select()
      .single();

    if (error) throw error;
    res.json(data);
  } catch (error) {
    res.status(400).json({ error: error.message });
  }
});
```

### Frontend - Zustand Store

```javascript
// Agregar a appStore.js
export const useAppStore = create((set) => ({
  // ... existing state ...
  
  // Preferences
  userLanguage: localStorage.getItem('language') || 'en',
  setUserLanguage: (language) => {
    localStorage.setItem('language', language);
    set({ userLanguage: language });
  }
}));
```

---

## ğŸ§ª Testing MultilingÃ¼e

### Test Coverage Checklist

- [ ] Idioma detectado automÃ¡ticamente (browser language)
- [ ] Cambio manual de idioma funciona
- [ ] Preferencia se guarda en DB
- [ ] Componentes muestran texto traducido
- [ ] Formularios validan en todos los idiomas
- [ ] Mensajes de error en idioma correcto
- [ ] Fechas/horarios en formato local (Fase 2)
- [ ] Moneda correcta por paÃ­s (Fase 2)

---

## ğŸ“¦ InstalaciÃ³n de Dependencias

```bash
cd frontend
npm install i18next react-i18next i18next-browser-languagedetector
```

```bash
cd backend
npm install i18next i18next-fs-backend
```

---

## ğŸš€ ImplementaciÃ³n Paso a Paso

### Paso 1: Crear estructura de carpetas
```bash
frontend/src/locales/
â”œâ”€ en/
â”œâ”€ es/
â”œâ”€ pt/
â””â”€ fr/
```

### Paso 2: Copiar archivos JSON de traducciones
- Copia todos los `.json` de arriba a sus carpetas correspondientes

### Paso 3: Agregar i18n config
- Copia `frontend/src/i18n/config.js`
- Actualiza `frontend/src/main.jsx`

### Paso 4: Actualizar componentes
- Importa `useTranslation` en cada componente
- Reemplaza strings con `t('namespace:key')`
- Agregar `LanguageSwitcher` en header

### Paso 5: Backend i18n
- Copia locales al backend
- Copia config.js al backend
- Agregar preferencia de idioma a usuarios

### Paso 6: Testear
- Cambia idioma en UI
- Verifica todo se traduce
- Cambia browser language â†’ detecta automÃ¡tico

---

## ğŸ’¡ Ejemplos de Uso

### En Componentes
```jsx
import { useTranslation } from 'react-i18next';

export default function MyComponent() {
  const { t, i18n } = useTranslation(['trips', 'common']);

  return (
    <div>
      <h1>{t('trips:dashboard.title')}</h1>
      <p>{t('common:loading')}</p>
      <button onClick={() => i18n.changeLanguage('es')}>
        Cambiar a EspaÃ±ol
      </button>
    </div>
  );
}
```

### En Validaciones
```jsx
const { t } = useTranslation('auth');

if (password.length < 8) {
  setError(t('errors.password_too_short'));
}
```

---

## ğŸŒ URLs Localizadas (Fase 2)

```
/en/dashboard
/es/dashboard
/pt/dashboard
/fr/dashboard

O parÃ¡metro: ?lang=es
```

---

**MultilingÃ¼e implementado. Listo para expandir a mÃ¡s idiomas.** ğŸŒ
